{% extends "base.html" %}

{% load tags_filters %}

{% block title %}Consulta de Validez Nacional{% endblock %}
{% block css_body_classes %}
{% css_classes "consulta-validez" %}
{% endblock %}
{% block content %}
<h2>Consulta de Validez Nacional</h2>

{% if flash %}
    {% include "flashes.html" %}
{% endif %}

<form action="" method="get">
<div class="form-filter" id="consultaValidezFormFilter">
    <h3>Búsqueda avanzada</h3>
    {{ form_filters.non_field_errors }}
    <div class="form-select">
		{{ form_filters.jurisdiccion.errors }}
		<label for="id_jurisdiccion">Jurisdicción:</label>
		{{ form_filters.jurisdiccion }}
    </div>
    <div class="form-text">
		{{ form_filters.cue.errors }}
		<label for="id_cue">CUE:</label>
		{{ form_filters.cue }}
    </div>
    <div class="form-select">
		{{ form_filters.unidad_educativa.errors }}
		<label for="id_unidad_educativa">Nombre del ISFD:</label>
		{{ form_filters.unidad_educativa }}
    </div>
    <div class="form-select">
		{{ form_filters.carrera.errors }}
		<label for="id_carrera">Carrera:</label>
		{{ form_filters.carrera }}
    </div>
    <div class="form-select">
		{{ form_filters.titulo.errors }}
		<label for="id_titulo">Título:</label>
		{{ form_filters.titulo }}
    </div>
    <div class="form-text">
		{{ form_filters.cohorte.errors }}
		<label for="id_cohorte">Cohorte:</label>
		{{ form_filters.cohorte }}
    </div>

    <div class="form-submit">
		<input type="submit" value="Buscar" />
		<input type="button" value="Reiniciar" onclick="window.location = '/consulta_validez';" />
    </div>
</div>

{% if objects %}
{% include "counter.html" %}
<table class="hor-zebra">
    <thead>
        <tr>
            <th>Jurisdicción</th>
            <th>CUE - Nombre del ISFD</th>
            <th>Carrera</th>
            <th>Título</th>
            <th>Primera / Última cohorte</th>
            <th>Normativa Jurisdiccional</th>
            <th>Normativa Nacional</th>
            <th>Número de INFD</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for obj in objects %}
            <tr class="{% cycle 'hor-zebra' 'hor-zebra_odd' %}">
                <td>{{ obj.unidad_educativa.jurisdiccion }}</td>
                <td>{{ obj.unidad_educativa.cue }} - {{ obj.unidad_educativa.nombre }}</td>
                <td>{{ obj.carrera }}</td>
                <td>{{ obj.denominacion }}</td>
                <td>{{ obj.primera }} - {{ obj.ultima }}</td>
                <td>{{ obj.normativa_jurisdiccional }}</td>
                <td>{{ obj.normativa_nacional }}</td>
                <td><a href="{% url consultaValidezDetalle obj.id %}" title="Ver detalle">{{ obj.nroinfd }}</a></td>
                <td class="actions-td">
                    <ul>
                        <li class="details"><a href="{% url consultaValidezDetalle obj.id %}" title="Ver detalle"><span>Ver detalle</span></a></li>
                    </ul>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% include "paginator.html" %}
</form>
{% else %}
<div class="message notice">
    <p>No se encontraron títulos.</p>
</div>
{% endif %}
<hr />

<script type="text/javascript">

// Init	
var dropdown_jurisdiccion = $("select#id_jurisdiccion");
var dropdown_unidad_educativa = $("select#id_unidad_educativa");
var dropdown_carrera = $("select#id_carrera");
var dropdown_titulo = $("select#id_titulo");

var current_jur = dropdown_jurisdiccion.val();
var current_ue = dropdown_unidad_educativa.val();
var current_carrera = dropdown_carrera.val();
var current_titulo = dropdown_titulo.val();


/*if(current_jur != '0'){
	jurisdiccion_change(current_jur);
}*/

function jurisdiccion_change(val){
	// Unidades educativas
	var url = "/consulta_validez/ajax/get_unidades_por_jurisdiccion/" + val;
	$.getJSON(url, function(models){
		var options = '<option value="0">---------</option>';
		for(var i = 0; i < models.length; i++){
			options += '<option value="' + models[i].pk + '">' + models[i].fields.cue + " - " + models[i].fields.nombre + '</option>';
		}
		dropdown_unidad_educativa.html(options);
	});

	// 	Carreras
	var url = "/consulta_validez/ajax/get_carreras/?jurisdiccion=" + val;
	$.getJSON(url, function(models){
		var options = '';	
		for(var i = 0; i < models.length; i++){
			options += '<option value="' + models[i][0] + '">' + models[i][1] + '</option>';
		}
		dropdown_carrera.html(options);
	});
	// 	Títulos
	var url = "/consulta_validez/ajax/get_titulos/?jurisdiccion=" + val;
	$.getJSON(url, function(models){
		var options = '';
		for(var i = 0; i < models.length; i++){
						options += '<option value="' + models[i][0] + '">' + models[i][1] + '</option>';
		}
		dropdown_titulo.html(options);
	});
}

function ue_change(val){
	// 	Carreras
	var url = "/consulta_validez/ajax/get_carreras/?unidad_educativa=" + val;
	$.getJSON(url, function(models){
		var options = '';	
		for(var i = 0; i < models.length; i++){
			options += '<option value="' + models[i][0] + '">' + models[i][1] + '</option>';
		}
		dropdown_carrera.html(options);
	});
	// 	Títulos
	var url = "/consulta_validez/ajax/get_titulos/?unidad_educativa=" + val;
	$.getJSON(url, function(models){
		var options = '';
		for(var i = 0; i < models.length; i++){
						options += '<option value="' + models[i][0] + '">' + models[i][1] + '</option>';
		}
		dropdown_titulo.html(options);
	});
}

function carrera_change(val){
	// 	Títulos
	var url = "/consulta_validez/ajax/get_titulos/?carrera=" + val + "&jurisdiccion=" + dropdown_jurisdiccion.val() + "&unidad_educativa=" + dropdown_unidad_educativa.val();
	$.getJSON(url, function(models){
		var options = '';
		for(var i = 0; i < models.length; i++){
						options += '<option value="' + models[i][0] + '">' + models[i][1] + '</option>';
		}
		dropdown_titulo.html(options);
	});
}

$(document).ready(function(){
    dropdown_jurisdiccion.change(function(){
		jurisdiccion_change($(this).val());
		first_load = false;
	}); // END function
    dropdown_unidad_educativa.change(function(){
		ue_change($(this).val());
		first_load = false;
	}); // END function
    dropdown_carrera.change(function(){
		carrera_change($(this).val());
		first_load = false;
	}); // END function
}); // END document.ready

// Init

</script>

{% endblock %}

