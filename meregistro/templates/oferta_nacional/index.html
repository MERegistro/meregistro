{% extends "base.html" %}

{% load tags_filters %}

{% block title %}Oferta Nacional de Carreras de Formación Docente {{ anio }}{% endblock %}
{% block css_body_classes %}
{% css_classes "consulta-validez" %}
{% endblock %}
{% block content %}
<h2>Oferta Nacional de Carreras de Formación Docente {{ anio }}</h2>

{% if flash %}
    {% include "flashes.html" %}
{% endif %}

<form action="" method="get">
<div class="form-filter" id="oferta-nacional-filters">
    <h3>Búsqueda avanzada</h3>
    {{ form_filters.non_field_errors }}
    <div class="form-select">
		{{ form_filters.jurisdiccion.errors }}
		<label for="id_jurisdiccion">Jurisdicción:</label>
		{{ form_filters.jurisdiccion }}
    </div>
    <div class="form-text">
		{{ form_filters.cue.errors }}
		<label for="id_cue">CUE:</label>
		{{ form_filters.cue }}
    </div>
    <div class="form-select">
		{{ form_filters.establecimiento.errors }}
		<label for="id_establecimiento">Nombre del ISFD:</label>
		{{ form_filters.establecimiento }}
    </div>
    <div class="form-select">
		{{ form_filters.carrera.errors }}
		<label for="id_carrera">Carrera:</label>
		{{ form_filters.carrera }}
    </div>

    <div class="form-submit">
		<input type="submit" value="Buscar" />
		<input type="button" value="Reiniciar" onclick="window.location = '/oferta_nacional/{{ anio }}';" />
    </div>
</div>

{% if objects %}
{% include "counter.html" %}
<ul class="reportes-actions">
    <li class="export-csv">
	<a href="{{ export_url }}" title="Exportar resultado en formato CSV"><span>Exportar Resultado</span></a>
    </li>
</ul>
<table class="hor-zebra">
    <thead>
        <tr>
            <th>Jurisdicción</th>
            <th>CUE - Nombre del ISFD</th>
            <th>Carrera</th>
        </tr>
    </thead>
    <tbody>
        {% for obj in objects %}
            <tr class="{% cycle 'hor-zebra' 'hor-zebra_odd' %}">
                <td>{{ obj.establecimiento.dependencia_funcional.jurisdiccion }}</td>
                <td>{{ obj.establecimiento.cue }} - {{ obj.establecimiento.nombre }}</td>
                <td style="white-space: nowrap;">{{ obj.cohorte.carrera_jurisdiccional.carrera }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% include "paginator.html" %}
</form>
{% else %}
<div class="message notice">
    <p>No se encontraron títulos.</p>
</div>
{% endif %}
<hr />

<script type="text/javascript">



function jurisdiccion_change(val){
	// Unidades educativas
	var url = "/oferta_nacional/ajax/get_establecimientos_por_jurisdiccion/" + val;
	$.getJSON(url, function(models){
		var options = '<option value="">---------</option>';
		for(var i = 0; i < models.length; i++){
			options += '<option value="' + models[i].pk + '">' + models[i].fields.cue + " - " + models[i].fields.nombre + '</option>';
		}
		dropdown_establecimiento.html(options);
	});

	// 	Carreras
	var url = "/oferta_nacional/ajax/get_carreras_por_jurisdiccion/" + val;
	$.getJSON(url, function(models){
		var options = '<option value="">---------</option>';
		for(var i = 0; i < models.length; i++){
			options += '<option value="' + models[i].pk + '">' + models[i].fields.nombre + '</option>';
		}
		dropdown_carrera.html(options);
	});
}

function establecimiento_change(val){
	// 	Carreras
	var url = "/oferta_nacional/ajax/get_carreras_por_establecimiento/" + val;
	$.getJSON(url, function(models){
		var options = '<option value="">---------</option>';
		for(var i = 0; i < models.length; i++){
			options += '<option value="' + models[i].pk + '">' + models[i].fields.nombre + '</option>';
		}
		dropdown_carrera.html(options);
	});
}

$(document).ready(function(){
		
	// Init	
	var dropdown_jurisdiccion = $("select#id_jurisdiccion");
	var dropdown_establecimiento = $("select#id_establecimiento");
	var dropdown_carrera = $("select#id_carrera");

	var current_jur = dropdown_jurisdiccion.val();
	var current_est = dropdown_establecimiento.val();
	var current_carrera = dropdown_carrera.val();
	
	if(dropdown_jurisdiccion.val() > 0){
		jurisdiccion_change(dropdown_jurisdiccion.val());
	}
	if(dropdown_establecimiento.val() > 0){
		establecimiento_change(dropdown_establecimiento.val());
	}
	
	//
	
    dropdown_jurisdiccion.change(function(){
		jurisdiccion_change($(this).val());
		first_load = false;
	}); // END function
    dropdown_establecimiento.change(function(){
		establecimiento_change($(this).val());
		first_load = false;
	}); // END function

	

}); // END document.ready


</script>

{% endblock %}

